---
import BaseLayout from '../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';
import { websiteJsonLd } from '../lib/jsonld';

const articles = await getCollection('articles');
const categories = await getCollection('categories');
const playbooks = await getCollection('playbooks');

const featuredArticles = articles.filter((a) => a.data.featured);
const sortedCategories = categories.sort((a, b) => a.data.order - b.data.order);

const jsonLd = websiteJsonLd('https://help.poppyflowers.com');
---

<BaseLayout
  title="Help Center"
  description="Find answers to your wedding flower questions. Pricing guides, design inspiration, florist booking tips, and everything you need for your perfect wedding florals."
  metaTitle="Poppy Flowers Help Center | Wedding Flower Guides & FAQs"
  jsonLd={jsonLd}
>
  <!-- Hero -->
  <section class="bg-brand-green text-white -mt-px">
    <div class="max-w-4xl mx-auto px-4 py-16 text-center">
      <h1 class="font-serif text-4xl md:text-5xl font-bold mb-4">
        How can we help?
      </h1>
      <p class="text-brand-sage text-lg max-w-2xl mx-auto">
        Everything you need to know about wedding flowers â€” from budgets and booking to design inspiration and flower care.
      </p>
    </div>
  </section>

  <!-- Categories Grid -->
  <section class="max-w-6xl mx-auto px-4 -mt-8">
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
      {sortedCategories.map((cat) => (
        <a
          href={`/categories/${cat.id}`}
          class="bg-white rounded-xl p-6 shadow-sm hover:shadow-md transition-shadow border border-gray-100 group"
        >
          <span class="text-3xl mb-3 block">{cat.data.icon}</span>
          <h2 class="font-serif text-lg font-semibold text-brand-green group-hover:text-brand-sage transition-colors">
            {cat.data.title}
          </h2>
          <p class="text-sm text-gray-600 mt-2 leading-relaxed">
            {cat.data.description}
          </p>
        </a>
      ))}
    </div>
  </section>

  <!-- Featured Articles -->
  <section class="max-w-6xl mx-auto px-4 mt-16">
    <h2 class="font-serif text-2xl font-bold text-brand-green mb-6">Popular Articles</h2>
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
      {featuredArticles.map((article) => (
        <a
          href={`/articles/${article.id}`}
          class="bg-white rounded-xl p-6 shadow-sm hover:shadow-md transition-shadow border border-gray-100 group"
        >
          <span class="text-xs font-medium uppercase tracking-wide text-brand-sage">
            {article.data.category.replace('-', ' & ').replace(/\b\w/g, (c: string) => c.toUpperCase())}
          </span>
          <h3 class="font-serif text-lg font-semibold mt-2 text-brand-charcoal group-hover:text-brand-green transition-colors">
            {article.data.title}
          </h3>
          <p class="text-sm text-gray-600 mt-2 leading-relaxed line-clamp-3">
            {article.data.description}
          </p>
        </a>
      ))}
    </div>
  </section>

  <!-- All Articles -->
  <section class="max-w-6xl mx-auto px-4 mt-16">
    <h2 class="font-serif text-2xl font-bold text-brand-green mb-6">All Articles</h2>
    <div class="bg-white rounded-xl shadow-sm border border-gray-100 divide-y divide-gray-100">
      {articles.map((article) => (
        <a
          href={`/articles/${article.id}`}
          class="flex items-center justify-between p-5 hover:bg-gray-50 transition-colors group"
        >
          <div>
            <h3 class="font-medium text-brand-charcoal group-hover:text-brand-green transition-colors">
              {article.data.title}
            </h3>
            <p class="text-sm text-gray-500 mt-1">{article.data.description}</p>
          </div>
          <span class="text-brand-sage text-xl ml-4 flex-shrink-0">&rarr;</span>
        </a>
      ))}
    </div>
  </section>

  <!-- Playbooks -->
  <section class="max-w-6xl mx-auto px-4 mt-16">
    <h2 class="font-serif text-2xl font-bold text-brand-green mb-6">Step-by-Step Guides</h2>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
      {playbooks.map((playbook) => (
        <a
          href={`/playbooks/${playbook.id}`}
          class="bg-white rounded-xl p-6 shadow-sm hover:shadow-md transition-shadow border border-gray-100 group"
        >
          <div class="flex items-start gap-4">
            <span class="bg-brand-green/10 text-brand-green rounded-lg p-3 text-xl">ðŸ“‹</span>
            <div>
              <h3 class="font-serif text-lg font-semibold text-brand-charcoal group-hover:text-brand-green transition-colors">
                {playbook.data.title}
              </h3>
              <p class="text-sm text-gray-600 mt-2 leading-relaxed">{playbook.data.description}</p>
              <span class="text-xs text-brand-sage mt-3 inline-block">{playbook.data.steps.length} steps &middot; {playbook.data.estimatedReadTime} min read</span>
            </div>
          </div>
        </a>
      ))}
    </div>
  </section>

  <!-- CTA -->
  <section class="max-w-4xl mx-auto px-4 mt-16 mb-8">
    <div class="bg-brand-blush rounded-2xl p-8 md:p-12 text-center">
      <h2 class="font-serif text-2xl md:text-3xl font-bold text-brand-green mb-4">
        Ready to start planning your wedding flowers?
      </h2>
      <p class="text-gray-700 mb-6 max-w-xl mx-auto">
        Book a free consultation with our team. We'll help you create a floral vision that's uniquely yours.
      </p>
      <a
        href="https://poppyflowers.com/consultation"
        class="inline-block bg-brand-green text-white px-8 py-3 rounded-lg font-medium hover:bg-brand-green/90 transition-colors"
      >
        Book a Consultation
      </a>
    </div>
  </section>
</BaseLayout>
